<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keysight Eggplant Partner Portal Deal Registration</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    /* --- ROOT & CORE STYLES --- */
    :root {
        --ks-red: #E90029;
        --ks-border: #e0e0e0;
        --ks-gray: #666;
        --ks-bg-light: #f9f9f9;
        --primary: #d8b4fe; 
        --primary-dark: #a855f7;
        --glass-border: rgba(255, 255, 255, 0.35);
    }

    body { font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; margin: 0; padding: 0; background-color: #ffffff; color: #333; }
    .top-bar { background-color: var(--ks-red); height: 45px; display: flex; justify-content: flex-end; align-items: center; padding: 0 10%; }
    .icon-circle { background-color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; text-decoration: none; margin-left: 15px;}
    .icon-circle i { color: var(--ks-red); font-size: 14px; }
    
    /* --- NAVBAR & RESPONSIVE NAV FIX --- */
    .navbar { background-color: #ffffff; height: 90px; border-bottom: 1px solid var(--ks-border); display: flex; align-items: center; padding: 0 10%; justify-content: space-between; transition: all 0.3s ease; }
    .navbar-brand img { height: 52.5px; } 
    .nav-navbar { display: flex; list-style: none; margin: 0; padding: 0; gap: 40px; }
    .nav-navbar li { font-weight: 400; font-size: 14px; color: #333; cursor: pointer; text-transform: uppercase; letter-spacing: 0.8px; transition: color 0.2s ease; }
    .nav-navbar li.active { font-weight: 700; color: var(--ks-red); }
    .nav-navbar li:hover { color: var(--ks-red); }

    @media (max-width: 850px) {
        .navbar { height: auto; padding: 20px 5%; flex-direction: column; gap: 20px; text-align: center; }
        .nav-navbar { gap: 15px; flex-wrap: wrap; justify-content: center; }
        .nav-navbar li { font-size: 12px; letter-spacing: 0.5px; }
    }

    /* --- PAGE CONTENT & FORM --- */
    .page-content { padding: 40px 10%; max-width: 1200px; margin: 0 auto; }
    h1 { font-size: 26px; margin-top: 30px; margin-bottom: 10px; font-weight: bold; }
    .instruction-text { font-size: 14px; color: #444; margin-bottom: 20px; line-height: 1.6; }
    
    .form-row { display: flex; gap: 30px; margin-bottom: 30px; }

    @media (max-width: 600px) { 
        .form-row { flex-direction: column; gap: 25px; margin-bottom: 25px; } 
        .page-content { padding: 20px 5%; }
    }

    .col-1 { flex: 1; position: relative; }
    .col-2 { flex: 2; position: relative; }
    .field-wrapper { position: relative; width: 100%; }
    input, select, textarea { width: 100%; padding: 22px 12px 6px 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 15px; background: white; box-sizing: border-box; outline: none; }
    label { position: absolute; left: 12px; top: 16px; color: var(--ks-gray); font-size: 14px; transition: all 0.2s ease-out; pointer-events: none; background: white; padding: 0 4px; }
    
    input:focus + label, input:not(:placeholder-shown) + label, 
    select:focus + label, select:not([data-value=""]) + label { top: -10px; left: 10px; font-size: 11px; color: var(--ks-red); font-weight: bold; }
    
    /* Textarea Specific Label Fix - No Overlap */
   /* SURGICAL FIX: Align label by adjusting the wrapper instead of margin */
    .field-wrapper textarea {
        margin-top: 0 !important; /* Remove the gap that was pushing the box away from the label */
    }

    .field-wrapper {
        margin-top: 10px; /* Move the whole unit down instead */
    }

    textarea + label { 
        top: -10px !important; /* This matches your other working inputs exactly */
        left: 10px !important; 
        font-size: 11px !important; 
        color: var(--ks-red) !important; 
        font-weight: bold !important; 
        background: white !important; 
        padding: 0 4px !important;
        z-index: 10 !important;
    }

    .prob-container { display: flex; border: 1px solid #ccc; background: white; border-radius: 4px; overflow: hidden; }
    .prob-container input { border: none; flex: 1; border-radius: 0; }
    .suffix { padding: 22px 10px 6px; background: #f4f4f4; border-left: 1px solid #ccc; color: #666; }
    .required { color: var(--ks-red); position: absolute; right: -15px; top: 16px; font-weight: bold; }
    
    #referral-upload-container { display: none; margin-bottom: 30px; padding: 40px; border: 2px dashed #ccc; background: #fafafa; text-align: center; transition: all 0.3s ease; opacity: 0; max-height: 0; overflow: hidden; border-radius: 12px; cursor: pointer; }
    #referral-upload-container.show { display: block; opacity: 1; max-height: 200px; }
    .btn-submit { background-color: var(--ks-red); color: white; padding: 15px 80px; border: none; font-weight: bold; cursor: pointer; text-transform: uppercase; border-radius: 4px; }
    @media (max-width: 600px) { .btn-submit { width: 100%; } }

    /* --- FOOTER --- */
    footer { margin-top: 60px; padding: 40px 10%; border-top: 1px solid var(--ks-border); background-color: #f9f9f9; display: flex; justify-content: space-between; align-items: flex-start; line-height: 1.5; font-size: 14px; }
    @media (max-width: 768px) { 
        footer { flex-direction: column; gap: 30px; align-items: center; text-align: center; padding: 40px 5%; }
        .footer-right { text-align: center; }
        .social-links { justify-content: center; }
    }
    .footer-left p { margin: 2px 0; }
    .footer-right strong { display: block; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }
    .social-links { display: flex; gap: 15px; }
    .social-links a { color: #333; font-size: 20px; transition: color 0.2s; }
    .social-links a:hover { color: var(--ks-red); }

    /* --- CHATBOT MOBILE OPTIMIZED --- */
    #chatbot-launcher {
        position: fixed; bottom: 30px; right: 30px; width: 75px; height: 75px;
        background: white; border-radius: 50%; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        cursor: pointer; z-index: 9999; display: flex; align-items: center; justify-content: center;
        border: 2.5px solid var(--primary); transition: all 0.3s ease;
    }
    @media (max-width: 480px) { #chatbot-launcher { width: 65px; height: 65px; bottom: 20px; right: 20px; } }
    
    #chatbot-launcher img { width: 48px; height: 48px; object-fit: contain; }
    .notif-badge { position: absolute; top: 0; right: 0; background: var(--ks-red); color: white; width: 22px; height: 22px; border-radius: 50%; font-size: 12px; font-weight: bold; display: none; align-items: center; justify-content: center; border: 2px solid white; }

    @keyframes eggy-wave { 0%, 100% { transform: rotate(0deg); } 25% { transform: rotate(-15deg); } 75% { transform: rotate(15deg); } }
    .wave-animate { animation: eggy-wave 0.5s ease-in-out 3; }

    #chatbot-window.chat-container {
        display: none; /* Keep this hidden by default so toggleChat() can work */
        position: fixed; bottom: 115px; right: 30px; width: 420px; height: 75vh;
        background: rgba(15, 23, 42, 0.7) !important; 
        backdrop-filter: blur(50px) saturate(210%); 
        -webkit-backdrop-filter: blur(50px) saturate(210%);
        border-radius: 32px;
        box-shadow: inset 0 1px 1px rgba(255, 255, 255, 0.3), 0 40px 80px rgba(0, 0, 0, 0.6); 
        border: 0.5px solid var(--glass-border);
        display: none; flex-direction: column; overflow: hidden; z-index: 10000;
    }

    /* EXACT INDEX00 RESPONSIVE LOGIC */
    @media (max-width: 480px) and (orientation: portrait) {
        .chat-container { 
            width: 82vw !important; 
            right: 15px !important; 
            height: 68vh !important; 
            bottom: 110px !important;
            border-radius: 24px !important;
        }
    }

    @media (max-height: 500px) and (orientation: landscape) {
        .chat-container { 
            height: 95vh !important; 
            width: 350px !important; 
            bottom: 10px !important; 
            right: 15px !important;
        }
    }

    .chat-header { padding: 0 1.5rem; background: linear-gradient(180deg, #d8b4fe 0%, #a855f7 100%); color: #ffffff; display: flex; justify-content: space-between; align-items: center; height: 55px; }
    
    /* Header Logo & Status Transparency Fix */
    .header-logo { 
        width: 35px !important; 
        height: 35px !important; 
        object-fit: contain; 
        background: transparent !important; 
        flex-shrink: 0; 
    }

    .status { 
        display: flex; 
        align-items: center; 
        gap: 0.8rem;
        max-height: 55px;
    }

    .status-indicator { width: 10px; height: 10px; background: #00ff00; border-radius: 50%; animation: blink-neon 2s infinite; box-shadow: 0 0 12px #00ff00; margin-left: 5px; }
    @keyframes blink-neon { 0%, 100% { opacity: 1; filter: brightness(1.2); } 50% { opacity: 0.4; filter: brightness(0.8); } }
    .status-text { font-family: 'Space Mono', monospace; font-size: 0.85rem; color: #ffffff; font-weight: 700; display: flex; align-items: center; }
    .close-chat { cursor: pointer; font-size: 1.2rem; color: white; transition: 0.2s; }
    .close-chat:hover { transform: rotate(90deg); }

    .quick-actions { padding: 1rem; display: flex; gap: 0.6rem; flex-wrap: wrap; background: rgba(255, 255, 255, 0.1); border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
    .quick-btn { padding: 0.5rem 1rem; background: rgba(255, 255, 255, 0.85); border: none; border-radius: 20px; color: #000; font-size: 0.8rem; font-weight: 600; cursor: pointer; transition: 0.3s; }
    
    .messages { flex: 1; padding: 2rem; overflow-y: auto; color: white; }
    .input-area { padding: 20px; background: rgba(255, 255, 255, 0.05); }
    .input-wrapper { display: flex; gap: 12px; background: white; padding: 8px 15px; border-radius: 30px; align-items: center; }
    #messageInput { flex: 1; border: none; outline: none; font-size: 1rem; padding: 8px; color: #333 !important; }
    #sendButton { background: var(--primary-dark); color: white; border: none; padding: 8px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; }

/* SURGICAL FIX: Landscape Optimization for Text and Buttons */
@media (max-height: 500px) and (orientation: landscape) {
    /* Shrink the Welcome Greeting */
    .chat-container h2 { 
        font-size: 1.1rem !important; 
        margin: 5px 0 !important; 
    }
    .chat-container p { 
        font-size: 0.85rem !important; 
        line-height: 1.2 !important; 
        margin-bottom: 8px !important;
    }

    /* Shrink Quick Action Buttons */
    .quick-actions {
        padding: 0.5rem !important;
        gap: 0.4rem !important;
    }
    .quick-btn {
        padding: 0.3rem 0.7rem !important;
        font-size: 0.75rem !important;
        border-radius: 12px !important;
    }

    /* Reduce message area padding to save vertical space */
    .messages { 
        padding: 1rem !important; 
    }

    /* Shrink the input area slightly */
    .input-area {
        padding: 10px 15px !important;
    }
    .input-wrapper {
        padding: 4px 12px !important;
    }
    }
    /* SURGICAL FIX: Force Safari dropdowns to match standard inputs */
    select {
        -webkit-appearance: none; /* Removes Safari default styling */
        -moz-appearance: none;
        appearance: none;
        background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center; /* Places the arrow icon */
        background-size: 12px;
        padding-right: 30px !important; /* Makes room for the new arrow */
        height: 52px !important; /* Force exact height match with inputs */
        line-height: normal !important;
    }

    /* Fix for iOS/Safari specific inner shadow */
    select:focus, input:focus {
        outline: none;
        box-shadow: none !important;
    }

/* Styling the links inside Eggy's responses */
.message a {
    color: #FF0000; /* Keysight Red */
    text-decoration: underline;
    font-weight: bold;
    padding: 2px 4px;
    background-color: rgba(255, 255, 255, 0.1); /* Subtle highlight */
    border-radius: 4px;
    transition: all 0.3s ease;
}

      /* Update this specific section in CSS */
.message div {
    word-wrap: break-word;       /* Older browsers */
    overflow-wrap: break-word;   /* Modern browsers */
    word-break: break-word;      /* Forces the URL to snap to a new line */
}
      
.message a:hover {
    color: #FFFFFF;
    background-color: #FF0000; /* Inverts colors when hovered */
    text-decoration: none;
}

/* Style for links inside Eggy's bubbles */
.assistant a {
    color: #FF0000; /* Keysight Red */
    font-weight: bold;
    text-decoration: underline;
}
      
/* Fix for lists that might lose their bullets */
.assistant ul {
    margin-left: 20px;
    padding-bottom: 10px;
}

/* Style for the Red Playbook Button */
.assistant a[href*="DealRegistrationPlaybook.pdf"] {
    display: inline-block;
    margin-top: 10px;
    padding: 10px 20px;
    background-color: #E11A22 !important; /* Force Keysight Red */
    color: #FFFFFF !important;
    text-decoration: none !important;
    border-radius: 5px;
    font-weight: bold;
    font-family: 'Space Mono', monospace;
    transition: all 0.3s ease; /* Smooth transition for color and movement */
}

/* Hover effect: Now forcing the color change */
.assistant a[href*="DealRegistrationPlaybook.pdf"]:hover {
    background-color: #000000 !important; /* Changes to Black or Darker Red */
    color: #FFFFFF !important;
    transform: translateY(-3px); /* The movement you already see */
    box-shadow: 0 5px 15px rgba(225, 26, 34, 0.4); /* Glow effect */
}

.quick-btn:active {
    transform: scale(0.95);
    background-color: var(--primary);
    color: white;
}
    
        /* Keep this: it flags the year 2025 or earlier as an error */
        #date:invalid {
            border-bottom: 2px solid #E11A22;
            color: #E11A22;
        }

        /* Keep this: subtle glow for better UX */
        #date:invalid:focus {
            outline: none;
            box-shadow: 0 0 5px rgba(225, 26, 34, 0.3);
        }

        /* Keep this: colors the icon red and fixes the iPhone spacing */
        #date::-webkit-calendar-picker-indicator {
            filter: invert(18%) sepia(88%) saturate(7467%) hue-rotate(352deg) brightness(91%) contrast(92%);
            cursor: pointer;
            margin-right: 2px; /* Surgical Fix: gives the icon a tiny bit of breathing room from the edge */
            padding: 0;
        }

    .bot-message b {
        color: #E11A22; /* Keysight Red for the tip title */
    }

    /* Make sure the chatbot doesn't jump around when new tips arrive */
    #chatbot-messages {
        scroll-behavior: smooth;
    }

</style>
</head>
<body>

<header>
    <div class="top-bar">
        <a href="#" class="icon-circle"><i class="fas fa-bell"></i></a>
        <a href="#" class="icon-circle"><i class="fas fa-user"></i></a>
    </div>
    <nav class="navbar">
        <div class="navbar-brand"><img src="https://eggplantpartners.keysight.com/images/logos/logo.png" alt="Keysight"></div>
        <ul class="nav-navbar">
            <li>Home</li><li>Asset Library</li><li class="active">Deals</li><li>Journey</li><li>Training</li><li>Events</li><li>Insignias</li>
        </ul>
    </nav>
</header>

<section class="page-content">

    <h1>Register New Deal</h1>
    <p class="instruction-text">To register a new deal, fill out the form below. Fields with an asterisk (<span style="color:var(--ks-red)">*</span>) are required.</p>

    <h1>Deal Information</h1>
    <p class="instruction-text">
        Please enter the information required for this deal. For a deal referral, it is mandatory to attach an invoice with the final referral fee after the closed won stage. This invoice must include the final referral fee amount, contact First and Last name, contact email, and should be uploaded in a timely manner.
    </p>

    <div class="form-container">
        <form id="dealForm">
            <div class="form-row">
                <div class="col-1 field-wrapper"><input type="text" id="dealName" placeholder=" " required><label>Deal Name</label><span class="required">*</span></div>
                <div class="col-2 field-wrapper">
                    <input type="text" id="customer" list="customer-list" placeholder=" " required>
                    <label>End Customer (Company, Country, Website)</label><span class="required">*</span>
                    <datalist id="customer-list">
                        <option value="New_AwesomeCompany | Estonia | www.newawesomecompany.com">
                        <option value="Quantum Dynamics | Finland | www.quantum-dyn.fi">
                        <option value="Baltic Logistics | Latvia | www.baltic-log.lv">
                        <option value="Helsinki Systems | Finland | www.helsinkisys.com">
                        <option value="Tallinn Tech | Estonia | www.tallinntech.ee">
                    </datalist>
                </div>
            </div>

            <div class="form-row">
                <div class="col-1 field-wrapper">
                    <input type="number" id="amount" placeholder=" " required min="25000">
                    <label>Min: $25k USD equiv.</label>
                    <span class="required">*</span>
                </div>
                
                <div class="col-1 field-wrapper">
                    <select id="currency" required data-value="">
                        <option value="" disabled selected hidden></option>
                        <option value="USD">USD - US Dollar</option>
                        <option value="EUR">EUR - Euro</option>
                        <option value="GBP">GBP - British Pound</option>
                        <option value="JPY">JPY - Japanese Yen</option>
                        <option value="AUD">AUD - Australian Dollar</option>
                        <option value="CAD">CAD - Canadian Dollar</option>
                        <option value="CHF">CHF - Swiss Franc</option>
                        <option value="CNY">CNY - Chinese Yuan</option>
                        <option value="INR">INR - Indian Rupee</option>
                        <option value="SGD">SGD - Singapore Dollar</option>
                        <option value="TWD">TWD - Taiwan New Dollar</option>
                        <option value="KRW">KRW - Korea (South) Won</option>
                        <option value="MYR">MYR - Malaysian Ringgit</option>
                        <option value="MXN">MXN - Mexican Peso</option>
                        <option value="BRL">BRL - Brazilian Real</option>
                        <option value="VND">VND - Vietnamese Dong</option>
                        <option value="THB">THB - Thai Baht</option>
                        <option value="ILS">ILS - Israeli New Shekel</option>
                        <option value="HKD">HKD - Hong Kong Dollar</option>
                        <option value="DKK">DKK - Danish Krone</option>
                        <option value="SEK">SEK - Swedish Krone</option>
                    </select>
                    <label>Currency</label><span class="required">*</span>
                </div>
                
                <div class="col-1 field-wrapper">
                    <select id="type" required data-value="">
                        <option value="" disabled selected hidden></option>
                        <option value="Deal">Deal</option>
                        <option value="Referral">Referral</option>
                    </select>
                    <label>Type</label><span class="required">*</span>
                </div>
            </div>

            <div class="form-row">
                <div class="col-1 field-wrapper">
                    <select id="stage" required data-value="">
                        <option value="" disabled selected hidden></option>
                        <option>New Deal</option><option>Prospecting</option><option>Discovery</option>
                        <option>Evaluating</option><option>Negotiation</option><option>Closed Won</option>
                        <option>Denied</option><option>Closed Lost</option>
                    </select>
                    <label>Stage</label><span class="required">*</span>
                </div>

                <div class="col-1 field-wrapper">
                    <div class="prob-container">
                        <input type="number" 
                               id="prob" 
                               placeholder=" " 
                               required 
                               min="1" 
                               max="100" 
                               oninput="this.value = Math.round(this.value)">
                        <label>Probability</label>
                        <div class="suffix">%</div>
                    </div>
                    <span class="required">*</span>
                </div>

        <div class="col-1 field-wrapper" style="padding-right: 15px; box-sizing: border-box;">
            <input type="date" 
                id="date" 
                placeholder=" " 
                required 
                min="2026-01-01" 
                max="2035-12-31"
                style="width: 100% !important; padding: 22px 12px 6px 12px !important;">
            <label>Close Date</label>
            <span class="required" style="position: absolute; right: 0; top: 16px;">*</span>
        </div>
        </div>
            <div class="form-row">
                <div class="col-2 field-wrapper">
                    <textarea id="briefDesc" placeholder="Please add additional details: project's overview, key decision makers, use case, key competitors and primary drivers to win the deal, new or existing end customer, etc." style="resize: vertical; min-height: 120px;" required></textarea>
                    <label>Brief Description</label><span class="required">*</span>
                </div>
                <div class="col-1 field-wrapper">
                    <select id="source" required data-value="">
                        <option value="" disabled selected hidden></option>
                        <option value="Deal Registration">Deal Registration</option>
                        <option value="Referral">Referral</option>
                        <option value="Email Campaign">Email Campaign</option>
                        <option value="Partner Locator">Partner Locator</option>
                        <option value="Social Campaign">Social Campaign</option>
                        <option value="Trade Show">Trade Show</option>
                        <option value="Web Syndication">Web Syndication</option>
                    </select>
                    <label>Source</label><span class="required">*</span>
                </div>
            </div>

            <div id="referral-upload-container" onclick="document.getElementById('file-input').click()">
                <input type="file" id="file-input" style="display:none" multiple>
                <div class="upload-content">
                    <i class="fas fa-download" style="color: #E11A22; margin-right: 8px;"></i>
                    <span class="upload-link"> Upload invoice file in pdf format</span> or drag and drop up to 10 files (Max 23.8 MB)
                </div>
            </div>
             <button type="submit" class="btn-submit">Submit</button>
 
        </form>

            <div id="success-message" style="display:none; text-align:center; padding:80px 20px;">
                <i class="fas fa-check-circle" style="color: #22c55e; font-size: 60px; filter: drop-shadow(0 0 10px rgba(34, 197, 94, 0.4));"></i>
                <h2 style="font-size: 28px; margin-top:20px;">Congratulations!</h2>
                <p style="font-size: 18px; color: #555;">The deal registration request has been submitted successfully.</p>
             <p>Your Keysight Regional Partner Account Manager will review the request within <strong>two business days</strong>.</p>
            </div>
   
    </div>
</section>

<div id="chatbot-launcher" onclick="toggleChat()">
    <div class="notif-badge" id="chat-notif">1</div>
    <img src="assets/images/EggySmall.png" alt="Eggy" id="eggy-img">
</div>

<div class="chat-container" id="chatbot-window">
    <div class="chat-header">
        <div class="status">
            <img src="assets/images/EggySmall.png" alt="Eggy" class="header-logo">
            <span class="status-text">Eggy is Online <div class="status-indicator"></div></span>
        </div>
        <div class="close-chat" onclick="toggleChat()"><i class="fas fa-times"></i></div>
    </div>

    <div class="quick-actions">
        <button class="quick-btn">New Deal Help</button>
        <button class="quick-btn">Requirements</button>
        <button class="quick-btn">Extensions</button>
        <button class="quick-btn">Deal Reg Guide</button>
    </div>

    <div class="messages" id="messages">
        <div class="welcome-message">
            <h2>Hi! I'm Eggy!</h2>
            <p>Your AI assistant for seamless deal registration on the Keysight Eggplant Partner Portal.</p>
        </div>
    </div>

    <div class="input-area">
        <div class="input-wrapper">
            <input type="text" id="messageInput" placeholder="How can I help you today?">
            <button id="sendButton">SEND</button>
        </div>
    </div>

</div>

<footer>
    <div class="footer-left">
        <strong>Contact Us</strong>
        <p>1400 Fountaingrove Parkway</p>
        <p>Santa Rosa, CA 95403-1738</p>
        <p>United States</p>
        <p>+1 800-829-4444</p>
        <p>ep-partners@keysight.com</p>
        <br>
        <p>¬© Keysight Technologies 2024</p>
    </div>
    <div class="footer-right">
        <strong>FOLLOW US</strong>
        <div class="social-links">
            <a href="https://www.linkedin.com/company/keysight-technologies" target="_blank"><i class="fab fa-linkedin"></i></a>
            <a href="https://x.com/Keysight" target="_blank">‚Äå<i class="fa-brands fa-x-twitter">‚Äå</i></a>
            <a href="https://www.facebook.com/Keysight" target="_blank"><i class="fab fa-facebook"></i></a>
            <a href="https://www.youtube.com/user/keysight" target="_blank"><i class="fab fa-youtube"></i></a>
            <a href="#"><i class="fab fa-weixin"></i></a>
        </div>
    </div>
</footer>

<script>
    /* --- PART 1: DEAL REGISTRATION PAGE LOGIC (No Changes) --- */
    const typeSelect = document.getElementById('type');
    const uploadBox = document.getElementById('referral-upload-container');
    const allSelects = document.querySelectorAll('select');
    if (typeSelect) {
        typeSelect.addEventListener('change', function() {
            if (this.value === 'Referral') { uploadBox.classList.add('show'); } 
            else { uploadBox.classList.remove('show'); }
        });
    }
    allSelects.forEach(s => {
        s.addEventListener('change', function() { this.setAttribute('data-value', this.value); });
    });

    /* --- PART 2: CHATBOT UI & STATE --- */
    let chatOpened = false;
    function toggleChat() {
        const chat = document.getElementById('chatbot-window');
        const notif = document.getElementById('chat-notif');
        const eggy = document.getElementById('eggy-img');
        chatOpened = true;
        if (chat) chat.style.display = (chat.style.display === 'flex') ? 'none' : 'flex';
        if (notif) notif.style.display = 'none';
        if (eggy) eggy.classList.remove('wave-animate');
    }

    /* --- PART 3: CHATBOT MESSAGING LOGIC --- */
    function addMessage(content, isUser) {
        const messagesContainer = document.getElementById('messages');
        if (!messagesContainer) return;
        const welcomeMessage = messagesContainer.querySelector('.welcome-message');
        if (welcomeMessage) welcomeMessage.remove();
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${isUser ? 'user' : 'assistant'}`;
        const avatarContent = isUser ? '<i class="fas fa-user"></i>' : '<img src="assets/images/EggySmall.png" alt="Eggy" style="width:30px;">';
        const author = isUser ? 'You' : 'Eggy';
        messageDiv.style.marginBottom = "15px";
        messageDiv.style.display = "flex";
        messageDiv.style.flexDirection = "column";
        messageDiv.style.alignItems = isUser ? "flex-end" : "flex-start";
        messageDiv.innerHTML = `
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px; opacity: 0.8; font-size: 0.75rem; font-family: 'Space Mono', monospace;">
                ${!isUser ? avatarContent : ''} <span>${author} ‚Ä¢ ${new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}</span> ${isUser ? avatarContent : ''}
            </div>
            <div style="background: ${isUser ? 'rgba(216, 180, 254, 0.2)' : 'rgba(255, 255, 255, 0.1)'}; 
                        padding: 12px 16px; border-radius: 18px; max-width: 85%; line-height: 1.5; 
                        border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(5px); color: white;">
                ${!isUser ? marked.parse(content) : content}
            </div>
        `;
        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

        /* --- EMERGENCY MODULE: SMART PRE-BUILT RESPONSES --- */
        async function getAIResponse(userMessage) {
        // Increased to 1.5 seconds for a more "analytical" feel
        await new Promise(resolve => setTimeout(resolve, 1200));

        const input = userMessage.toLowerCase();
        
        // 1. Playbook & Rules (High Priority)
        if (input.includes("rule") || input.includes("playbook") || input.includes("guide")) {
            return "As the Program Manager who architected the **Deal Registration Playbook**, I've ensured our rules are built for partner success: \n\n" +
                "* **Threshold:** Minimum deal size is **$25,000 USD** equivalent.\n" +
                "* **Timing:** Register at least **14 days** before the expected close.\n" +
                "* **Exclusions:** Renewals and RFPs are not eligible for registration protection.\n\n" +
                "Would you like to **preview the strategy** now, or save it for later?\n\n" +
                "üìÑ <b><a href='assets/DealRegistrationPlaybook.pdf' target='_blank' style='display: inline !important; background: none !important; color: #d8b4fe !important; padding: 0 !important; border: none !important; font-weight: bold;'>Review in Browser</a></b> (Live View)\n\n" +
                "You can download it below:\n\n" +
                "<a href='assets/DealRegistrationPlaybook.pdf' download='DealRegistrationPlaybook.pdf' " +
                "style='display: inline-block; padding: 12px 24px; background-color: #E11A22; color: white; " +
                "text-decoration: none; border-radius: 6px; font-weight: bold; box-shadow: 0 4px 6px rgba(0,0,0,0.2);'>" +
                "<i class='fas fa-download' style='margin-right: 8px;'></i> Download PDF Playbook</a>";  
        }

        // 2. Threshold & Currency (Contextual)
        if (input.includes("limit") || input.includes("amount") || input.includes("25") || input.includes("money")) {
            return "The **$25,000 USD threshold** is a hard rule from our Playbook. Use the currency dropdown in the form to check the real-time conversion. If the deal is smaller, it won't qualify for registration benefits.";
        }

        // 3. Extensions (Quick Action Support)
        if (input.includes("extension") || input.includes("expire") || input.includes("long") || input.includes("90") || input.includes("midpoint") || input.includes("check")) {
            return "Deals are protected for **180 days**. However, the **90-day midpoint check** is mandatory: you must conduct a customer evaluation and demonstrate progress to keep protection active. Failing to show progress leads to the deal being 'unregistered'.";
        }

        // 4. Requirements & Steps
        if (input.includes("requirement") || input.includes("need") || input.includes("step")) {
            return "To successfully register, you need: \n1. **End Customer details** (Legal name & Website).\n2. **Project overview** and key drivers to win.\n3. **Technical discovery** confirmation.\n\nI'll check these as you fill out the form!";
        }

        // 5. Help with New Deal (Quick Action Support)
        if (input.includes("new deal") || input.includes("start")) {
            return "I'm ready! Start by entering the **Deal Name** and selecting the **End Customer**. I recommend using a descriptive name like 'Project Quantum - Eggplant AI Enablement'.";
        }

        // 6. Rejection & Termination (new logic)
        if (input.includes("reject") || input.includes("denied") || input.includes("lose") || input.includes("remove")) {
            return "üßê **Why deals get rejected:**\n\n" +
                "* **Legal:** Keysight may be obligated to bid directly.\n" +
                "* **Inattentiveness:** Not actively working the deal.\n" +
                "* **First-Come:** Another partner was faster.\n" +
                "* **Competing:** Offering other products for the same deal.";
        }

        // 7. Referral vs Deal Registration
        if (input.includes("referral") || input.includes("refer") || input.includes("hand-off")) {
            return "As part of the **Eggplant AI Enablement** strategy, we distinguish between two paths:\n\n" +
                "* **Deal Registration:** You lead the sales cycle. Requires a **$25k minimum**.\n" +
                "* **Referral:** You identify the opportunity and 'hand-off' to our team. You can track progress via the **'Deal Stage'** dropdown in the portal.\n\n" +
                "**Mandatory Invoice:** If the deal reaches **'Closed Won'**, you must upload a PDF invoice including the company name, closing date, fee amount, and authorizing contact.\n\n" +
                "**Note on Fees:** Specific amounts are outlined in your individual **Partner Sales Agreement (PSA)** rather than the Playbook, as they are tier-dependent.";
        }

        // 8. New Section Government/Bids
        if (input.includes("government") || input.includes("bid") || input.includes("rfp")) {
            return "For **Open Bids/Government contracts**: \n\n" +
                "* **RFPs:** Standard deal registration is not eligible.\n" +
                "* **Bids:** A non-registered discount may be given to all resellers, but the full protected discount is awarded to the partner who **wins the contract award**.";
        }

        // 9. New Section Presales Effort
        if (input.includes("effort") || input.includes("proof") || input.includes("work")) {
            return "To qualify for protection, you must document **significant presales efforts**, such as: \n\n" +
                "* Meeting with decision-makers.\n" +
                "* Quantifying project budgets.\n" +
                "* Qualifying technical requirements.\n\n" +
                "Keysight may audit these records at any time to verify compliance.";
        }

        // 10. Confirmation & Post-Submission Support
        if (input.includes("notification") || input.includes("after") || input.includes("next steps") || input.includes("wait")) {
            return "Once submitted, here is the timeline:\n\n" +
                "* **Response:** You will receive an email notification within **two business days** (Accepted or Declined).\n" +
                "* **Support Team:** If accepted, Keysight assigns a **dedicated Sales Executive and Solution Architect** to help your team close the deal.\n\n" +
                "This ensures you have full technical and commercial alignment to win!";
        }

        // 11. Audits & Ethical Conduct
            if (input.includes("audit") || input.includes("compliance") || input.includes("integrity") || input.includes("violation") || input.includes("rules")) {
                return "Keysight maintains program integrity through strict compliance rules:\n\n" +
                    "* **Audits:** Keysight may audit deals at any time to verify any documents or info submitted.\n" +
                    "* **Denial/Removal:** Registrations can be rescinded if a partner is inattentive, offers competitive products, or provides inaccurate/fraudulent info.\n" +
                    "* **Non-Disclosure:** Partners must **not** discuss Deal Registration details with customers or use them to influence choice between partners.\n" +
                    "* **Final Authority:** Keysight‚Äôs interpretation of these guidelines is non-negotiable and final.";
            }

        // 12. Eggy's Greetings
        if (input.includes("hello") || input.includes("hi") || input.includes("hey")) {
            return "Hi! I'm **Eggy**. I helped design the Keysight Eggplant partner rules. I'm here to make sure your deal registration is perfect so it gets approved fast!";
        }

        // Default "Smart" Fallback
        return "That's a good question. While I'm in 'Demo Mode', I'm focused on the **Deal Registration Playbook** rules. Try asking me about 'Requirements', 'Extensions', or the '$25k Threshold'!";
    }   
    
        async function sendMessage() {
        const input = document.getElementById('messageInput');
        if (!input || !input.value.trim()) return;
        const message = input.value.trim();
        input.disabled = true;
        addMessage(message, true);
        input.value = '';

        // Add "typing" placeholder
        const messagesContainer = document.getElementById('messages');
        const typingDiv = document.createElement('div');
        typingDiv.id = 'typing-indicator';
        typingDiv.innerHTML = `<div style="color:rgba(255,255,255,0.5); font-size:0.8rem; margin-bottom:15px; padding-left:10px;">Eggy is thinking...</div>`;
        messagesContainer.appendChild(typingDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;

        const response = await getAIResponse(message);
        
        // Remove typing indicator and show response
        document.getElementById('typing-indicator').remove();
        addMessage(response, false);
        input.disabled = false;
        input.focus();
    }

    /* --- PART 4: EVENT LISTENERS --- */
    document.addEventListener('DOMContentLoaded', () => {
        // FIXED QUICK BUTTONS LOGIC
        document.querySelectorAll('.quick-btn').forEach(btn => {
            btn.addEventListener('click', async () => {
                const query = btn.innerText;
                const input = document.getElementById('messageInput');
                
                // Put the text in the input and trigger the existing sendMessage function
                input.value = query;
                sendMessage();
            });
        });
    
        const msgInput = document.getElementById('messageInput');
        if (msgInput) msgInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') sendMessage(); });
        
        const sendBtn = document.getElementById('sendButton');
        if (sendBtn) sendBtn.addEventListener('click', sendMessage);
    
        // Notification Logic
        setTimeout(() => {
            if (!chatOpened) {
                const notif = document.getElementById('chat-notif');
                const eggy = document.getElementById('eggy-img');
                if (notif) notif.style.display = 'flex';
                if (eggy) eggy.classList.add('wave-animate');
            }
        }, 5000);
    });
        

    /* --- PART 5: AGENTIC FIELD OBSERVER --- */
    document.addEventListener('DOMContentLoaded', () => {
        // Map your Form Field IDs to the specific keyword in your getAIResponse logic
        const fieldTips = {
            'deal-name': 'new deal',
            'customer-name': 'requirement',
            'deal-amount': 'limit',
            'deal-type': 'referral',
            'closing-date': 'extension'
        };

        // Attach listeners to each field
        Object.keys(fieldTips).forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) {
                field.addEventListener('focus', async () => {
                    // Only trigger if the chatbot container is open (active)
                    const chatbotContainer = document.getElementById('chatbot-container');
                    if (chatbotContainer.classList.contains('active')) {
                        
                        const triggerKeyword = fieldTips[fieldId];
                        const tipResponse = await getAIResponse(triggerKeyword);
                        
                        // Add a special 'agent-tip' class so it looks different from a regular chat
                        addMessage("<b>Eggy's Pro-Tip:</b> " + tipResponse, 'bot');
                    }
                });
            }
        });
    });

/* --- REFINED PART 6: ACTIVE GOVERNANCE MODULE --- */
document.querySelectorAll('input, select').forEach(field => {
    field.addEventListener('blur', async (e) => {
        const value = e.target.value;
        const fieldId = e.target.id;
        const chatWindow = document.getElementById('chatbot-window');
        let alertMessage = "";
        
        // SMART LOGIC 1: Threshold Validation
        if (fieldId === 'amount' && value !== "" && parseFloat(value) < 25000) {
            alertMessage = "Hey! üëã Just a heads up - the minimum deal size is <strong>$25,000 USD</strong>. You entered <strong>$" + value + "</strong>. Want to double-check that amount?";
        }
        
        // SMART LOGIC 2: Timing Validation
        if (fieldId === 'date' && value !== "") {
            const daysToClose = (new Date(value) - new Date()) / (1000 * 60 * 60 * 24);
            if (daysToClose < 14 && daysToClose > 0) {
                alertMessage = "‚è∞ Close date is in <strong>" + Math.floor(daysToClose) + " days</strong> - we need <strong>14+ days</strong> to process. Adjust the date, or contact your PAM if urgent!";
            } 
        }
        
        // ACTION: If an alert exists, FORCE the chat to open and speak
        if (alertMessage) {
            chatWindow.style.display = 'flex';
            chatOpened = true;
            const notif = document.getElementById('chat-notif');
            if (notif) notif.style.display = 'none';
            addMessage(alertMessage, false);
            const eggy = document.getElementById('eggy-img');
            if (eggy) eggy.classList.add('wave-animate');
        }
    });
});

/* --- PART 7: STAGE-BASED SALES ENABLEMENT --- */
const stageSelect = document.getElementById('stage');

if (stageSelect) {
    stageSelect.addEventListener('change', async function() {
        const stage = this.value;
        const chatWindow = document.getElementById('chatbot-window');
        let eggyResponse = "";

        if (stage === "Closed Won") {
            // Keep it clean for the winner
            eggyResponse = "üèÜ **Huge Congratulations!** Ensuring this deal is registered correctly now secures your commission. I'll make sure the hand-off to the fulfillment team is seamless!";
        } 
        
        else if (stage === "Negotiation") {
            eggyResponse = "ü§ù **The Home Stretch!** To help you cross the finish line, check out our **[Short Battlecard](assets/Eggplant_Battlecard.pdf)**. \n\n" +
                           "Also, I highly recommend this **1.5 min Executive Pitch video** to share with your customer's procurement lead: \n\n" +
                           "<a href='assets/Eggplant_Pitch.mp4' target='_blank' style='display: inline-block; padding: 10px 15px; background: #E11A22; color: white; border-radius: 5px; text-decoration: none; font-weight: bold;'>‚ñ∂Ô∏è Watch 1.5m Pitch</a>";
        } 
        
        else if (stage === "Evaluating") {
            eggyResponse = "üîç **Technical Deep Dive!** To give you the best resources, which sector is this customer focused on? \n\n" +
                           "* **Core Test & Measurement?** [View Asset Library A](#)\n" +
                           "* **AI/Software Automation?** [View Asset Library B](#)\n\n" +
                           "Knowing the sector helps me align the right Solution Architect to your deal!";
        }

        // Trigger Eggy if we have a specific response
        if (eggyResponse) {
            chatWindow.style.display = 'flex';
            addMessage(eggyResponse, false);
            const eggyImg = document.getElementById('eggy-img');
            if (eggyImg) eggyImg.classList.add('wave-animate');
        }
    });
}

/* --- PART 8: SUBMIT BUTTON GOVERNANCE --- */
const submitBtn = document.querySelector('.btn-submit');

// We add a 'pointer-events' check or a simple flag
let hasCriticalViolation = false; 

function updateSubmitState(isViolated) {
    hasCriticalViolation = isViolated;
    if (hasCriticalViolation) {
        submitBtn.style.opacity = "0.5";
        submitBtn.style.cursor = "not-allowed";
        submitBtn.innerText = "Check Eggy's Feedback";
    } else {
        submitBtn.style.opacity = "1";
        submitBtn.style.cursor = "pointer";
        submitBtn.innerText = "Submit Registration";
    }
}

// Now, inside your blur event (Part 7), just call this!
// If alertMessage is not empty, updateSubmitState(true);
// Else, updateSubmitState(false);

    document.getElementById('date').addEventListener('blur', function() {
        const year = new Date(this.value).getFullYear();
        if (year < 2026) {
            alert("Please enter a valid future year (2026 or later).");
            this.value = ''; // Clear the invalid date
        }
    });

    document.querySelector('.btn-submit').addEventListener('click', function(e) {
        const form = this.closest('form') || document.querySelector('form');
        const successDiv = document.getElementById('success-message');

        if (form.checkValidity()) {
            e.preventDefault(); 
            
            // 1. Hide the form
            form.style.display = 'none';
            
            // 2. Hide the headers so the Congratulations message is the star of the show
            document.querySelectorAll('.page-content h1, .page-content .instruction-text').forEach(el => el.style.display = 'none');
            
            // 3. Show Success Message
            successDiv.style.display = 'block';
            window.scrollTo(0, 0);

            // 4. Modern Tech Confetti with Keysight Red
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 },
                colors: [
                    '#E11A22', // Keysight Red (Keeping it for brand pop!)
                    '#22c55e', // Success Green
                    '#6366f1', // Electric Indigo
                    '#a855f7', // Cyber Purple
                    '#fcd34d'  // Golden Sparkle
                ]
            });
        }
    });

</script>

</body>
</html>
